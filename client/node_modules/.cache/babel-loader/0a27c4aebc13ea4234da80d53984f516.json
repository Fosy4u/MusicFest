{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from 'react';\nimport { useStateValue } from '../utilities/StateProvider';\nimport axios from 'axios';\nimport { useHistory } from \"react-router-dom\";\nexport default function UseAuth({\n  code\n}) {\n  _s();\n\n  const history = useHistory();\n  const [{\n    user,\n    token,\n    playlists,\n    active_playlist\n  }, dispatch] = useStateValue();\n  const [accessToken, setAccessToken] = useState();\n  const [refreshToken, setRefreshToken] = useState();\n  const [expiresIn, setExpiresIn] = useState();\n  console.log('code is ', code);\n  console.log('expiresIn is ', expiresIn);\n  useEffect(() => {\n    axios.post('http://localhost:3001/login', {\n      code\n    }).then(res => {\n      console.log('res :', res);\n      setAccessToken(res.data.accessToken);\n      setRefreshToken(res.data.refreshToken);\n      setExpiresIn(res.data.expiresIn);\n      history.push('/');\n    }).catch(() => {\n      history.push('/');\n    });\n  }, [code]);\n  useEffect(() => {\n    if (refreshToken || expiresIn) {\n      console.log('this is :', refreshToken);\n      const interval = setInterval(() => {\n        axios.post('http://localhost:3001/refresh', {\n          refreshToken\n        }).then(res => {\n          console.log('refresh :', res);\n          setAccessToken(res.data.accessToken);\n          setExpiresIn(res.data.expiresIn);\n          history.push('/');\n        }).catch(() => {\n          history.push('/');\n        });\n      }, (expiresIn - 60) * 1000);\n      return () => clearInterval(interval);\n    }\n  }, [refreshToken, expiresIn]);\n  return accessToken;\n}\n\n_s(UseAuth, \"ZCk4jRtBq5Ep2bV2YPvDAKgBkBM=\", false, function () {\n  return [useHistory, useStateValue];\n});\n\n_c = UseAuth;\n\nvar _c;\n\n$RefreshReg$(_c, \"UseAuth\");","map":{"version":3,"sources":["C:/Users/FosterOgwudu/Desktop/MyProjects/MusicFest/client/src/components/UseAuth.js"],"names":["React","useState","useEffect","useStateValue","axios","useHistory","UseAuth","code","history","user","token","playlists","active_playlist","dispatch","accessToken","setAccessToken","refreshToken","setRefreshToken","expiresIn","setExpiresIn","console","log","post","then","res","data","push","catch","interval","setInterval","clearInterval"],"mappings":";;AAAA,OAAOA,KAAP,IAAeC,QAAf,EAAyBC,SAAzB,QAAyC,OAAzC;AACA,SAASC,aAAT,QAA8B,4BAA9B;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,SAASC,UAAT,QAA2B,kBAA3B;AAEA,eAAe,SAASC,OAAT,CAAiB;AAACC,EAAAA;AAAD,CAAjB,EAAyB;AAAA;;AACpC,QAAMC,OAAO,GAAGH,UAAU,EAA1B;AACA,QAAM,CAAC;AAACI,IAAAA,IAAD;AAAMC,IAAAA,KAAN;AAAaC,IAAAA,SAAb;AAAwBC,IAAAA;AAAxB,GAAD,EAA2CC,QAA3C,IAAuDV,aAAa,EAA1E;AACA,QAAM,CAACW,WAAD,EAAcC,cAAd,IAAgCd,QAAQ,EAA9C;AACA,QAAM,CAACe,YAAD,EAAeC,eAAf,IAAkChB,QAAQ,EAAhD;AACA,QAAM,CAACiB,SAAD,EAAYC,YAAZ,IAA4BlB,QAAQ,EAA1C;AACAmB,EAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBd,IAAxB;AACAa,EAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ,EAA6BH,SAA7B;AAEAhB,EAAAA,SAAS,CAAC,MAAM;AAEZE,IAAAA,KAAK,CAACkB,IAAN,CAAW,6BAAX,EAA0C;AACtCf,MAAAA;AADsC,KAA1C,EAEGgB,IAFH,CAESC,GAAD,IAAS;AACbJ,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBG,GAArB;AACAT,MAAAA,cAAc,CAACS,GAAG,CAACC,IAAJ,CAASX,WAAV,CAAd;AACAG,MAAAA,eAAe,CAACO,GAAG,CAACC,IAAJ,CAAST,YAAV,CAAf;AACAG,MAAAA,YAAY,CAACK,GAAG,CAACC,IAAJ,CAASP,SAAV,CAAZ;AACAV,MAAAA,OAAO,CAACkB,IAAR,CAAa,GAAb;AACH,KARD,EAQGC,KARH,CAQS,MAAK;AACVnB,MAAAA,OAAO,CAACkB,IAAR,CAAa,GAAb;AACH,KAVD;AAYH,GAdQ,EAcN,CAACnB,IAAD,CAdM,CAAT;AAgBAL,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAGc,YAAY,IAAIE,SAAnB,EAA+B;AAC3BE,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAwBL,YAAxB;AACL,YAAMY,QAAQ,GAAGC,WAAW,CAAC,MAAM;AAC9BzB,QAAAA,KAAK,CAACkB,IAAN,CAAW,+BAAX,EAA4C;AAC5CN,UAAAA;AAD4C,SAA5C,EAEDO,IAFC,CAEKC,GAAD,IAAS;AACbJ,UAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBG,GAAzB;AACAT,UAAAA,cAAc,CAACS,GAAG,CAACC,IAAJ,CAASX,WAAV,CAAd;AACAK,UAAAA,YAAY,CAACK,GAAG,CAACC,IAAJ,CAASP,SAAV,CAAZ;AACAV,UAAAA,OAAO,CAACkB,IAAR,CAAa,GAAb;AACH,SAPG,EAODC,KAPC,CAOK,MAAK;AACVnB,UAAAA,OAAO,CAACkB,IAAR,CAAa,GAAb;AACH,SATG;AAUH,OAX0B,EAWxB,CAACR,SAAS,GAAG,EAAb,IAAiB,IAXO,CAA5B;AAaC,aAAO,MAAOY,aAAa,CAACF,QAAD,CAA3B;AAEH;AAKA,GAvBQ,EAuBN,CAACZ,YAAD,EAAeE,SAAf,CAvBM,CAAT;AA2BA,SAAOJ,WAAP;AACH;;GArDuBR,O;UACJD,U,EAC6CF,a;;;KAFzCG,O","sourcesContent":["import React, {useState, useEffect} from 'react';\r\nimport { useStateValue } from '../utilities/StateProvider';\r\nimport axios from 'axios';\r\nimport { useHistory } from \"react-router-dom\"\r\n\r\nexport default function UseAuth({code}) {\r\n    const history = useHistory();\r\n    const [{user,token, playlists, active_playlist}, dispatch] = useStateValue();\r\n    const [accessToken, setAccessToken] = useState()\r\n    const [refreshToken, setRefreshToken] = useState()\r\n    const [expiresIn, setExpiresIn] = useState()\r\n    console.log('code is ', code)\r\n    console.log('expiresIn is ', expiresIn)\r\n\r\n    useEffect(() => {\r\n        \r\n        axios.post('http://localhost:3001/login', {\r\n            code\r\n        }).then((res) => {\r\n            console.log('res :', res);\r\n            setAccessToken(res.data.accessToken);\r\n            setRefreshToken(res.data.refreshToken);\r\n            setExpiresIn(res.data.expiresIn);\r\n            history.push('/')\r\n        }).catch(() =>{\r\n            history.push('/')\r\n        })\r\n        \r\n    }, [code])\r\n\r\n    useEffect(() => {\r\n        if(refreshToken || expiresIn ) {\r\n            console.log('this is :',refreshToken)\r\n       const interval = setInterval(() => {\r\n            axios.post('http://localhost:3001/refresh', {\r\n            refreshToken,\r\n        }).then((res) => {\r\n            console.log('refresh :', res);\r\n            setAccessToken(res.data.accessToken);\r\n            setExpiresIn(res.data.expiresIn);\r\n            history.push('/')\r\n        }).catch(() =>{\r\n            history.push('/')\r\n        })\r\n        }, (expiresIn - 60)*1000)\r\n\r\n        return () =>  clearInterval(interval)\r\n        \r\n    }\r\n    \r\n  \r\n    \r\n        \r\n    }, [refreshToken, expiresIn])\r\n\r\n\r\n    \r\n    return accessToken\r\n}\r\n"]},"metadata":{},"sourceType":"module"}